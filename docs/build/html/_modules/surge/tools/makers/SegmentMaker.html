

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>surge.tools.makers.SegmentMaker &mdash; Surge  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="Surge  documentation" href="../../../../index.html"/>
        <link rel="up" title="Module code" href="../../../index.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> Surge
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Surge</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>surge.tools.makers.SegmentMaker</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for surge.tools.makers.SegmentMaker</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Created on Oct 31, 2015</span>

<span class="sd">@author: josephdavancens</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">surge.materials.staff_map</span> <span class="k">import</span> <span class="n">staff_map</span>
<span class="kn">from</span> <span class="nn">surge.tools.templates.ScoreTemplate</span> <span class="k">import</span> <span class="n">ScoreTemplate</span>
<span class="kn">from</span> <span class="nn">surge.tools.makers.SegmentMakerBaseClass</span> \
    <span class="kn">import</span> <span class="nn">SegmentMakerBaseClass</span>
<span class="kn">from</span> <span class="nn">surge.tools.utilities.flatten_list</span> <span class="k">import</span> <span class="n">flatten_list</span>
<span class="kn">from</span> <span class="nn">surge.tools.utilities.make_spacer_skip_measures</span> <span class="k">import</span> \
    <span class="n">make_spacer_skip_measures</span>
<span class="kn">import</span> <span class="nn">abjad</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>


<div class="viewcode-block" id="SegmentMaker"><a class="viewcode-back" href="../../../../surge.tools.makers.html#surge.tools.makers.SegmentMaker.SegmentMaker">[docs]</a><span class="k">class</span> <span class="nc">SegmentMaker</span><span class="p">(</span><span class="n">SegmentMakerBaseClass</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Segment-maker</span>
<span class="sd">    Fills a score template with music created in a segment_xx definition</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># CLASS ATTRIBUTES</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;_cached_score_template_start_clefs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_cached_score_template_start_instruments&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_final_markup&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_final_markup_extra_offset&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_is_last_segment&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_music_handlers&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_page_size&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_part&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_ruler&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_score&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_segment_number&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_show_stage_annotations&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_stages&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_staff_size&#39;</span><span class="p">,</span>
        <span class="s1">&#39;check_well_formedness&#39;</span><span class="p">,</span>
        <span class="s1">&#39;final_barline&#39;</span><span class="p">,</span>
        <span class="s1">&#39;instrument_list&#39;</span><span class="p">,</span>
        <span class="s1">&#39;measures_per_stage&#39;</span><span class="p">,</span>
        <span class="s1">&#39;segment_name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;title&#39;</span><span class="p">,</span>
        <span class="s1">&#39;number_of_stages&#39;</span><span class="p">,</span>
        <span class="s1">&#39;raise_approximate_duration&#39;</span><span class="p">,</span>
        <span class="s1">&#39;first_bar_number&#39;</span><span class="p">,</span>
        <span class="s1">&#39;time_signatures&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tempo_map&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># INITIALIZER</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">title</span><span class="p">,</span>
        <span class="n">segment_name</span><span class="p">,</span>
        <span class="n">final_barline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">final_markup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">final_markup_extra_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">instrument_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_last_segment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">raise_approximate_duration</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">check_well_formedness</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">show_stage_annotations</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">first_bar_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">number_of_stages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">measures_per_stage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">page_size</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;11x17&#39;</span><span class="p">,</span> <span class="s1">&#39;portrait&#39;</span><span class="p">),</span>
        <span class="n">segment_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tempo_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">time_signatures</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">staff_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">part</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ruler</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">header_font</span><span class="o">=</span><span class="s1">&#39;Open Sans&#39;</span><span class="p">,</span>
        <span class="n">body_font</span><span class="o">=</span><span class="s1">&#39;Open Sans&#39;</span>
    <span class="p">):</span>
        <span class="n">superclass</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SegmentMaker</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">superclass</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_name</span> <span class="o">=</span> <span class="n">segment_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_barline</span> <span class="o">=</span> <span class="n">final_barline</span>
        <span class="k">if</span> <span class="n">final_markup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">final_markup</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Markup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_final_markup</span> <span class="o">=</span> <span class="n">final_markup</span>
        <span class="k">if</span> <span class="n">final_markup_extra_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">final_markup_extra_offset</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_final_markup_extra_offset</span> <span class="o">=</span> <span class="n">final_markup_extra_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_last_segment</span> <span class="o">=</span> <span class="n">is_last_segment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_bar_number</span> <span class="o">=</span> <span class="n">first_bar_number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_list</span> <span class="o">=</span> <span class="n">instrument_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_music_handlers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">number_of_stages</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_of_stages</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">measures_per_stage</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">number_of_stages</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">measures_per_stage</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="n">number_of_stages</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_of_stages</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">measures_per_stage</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_of_stages</span> <span class="o">=</span> <span class="n">number_of_stages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_page_size</span> <span class="o">=</span> <span class="n">page_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measures_per_stage</span> <span class="o">=</span> <span class="n">measures_per_stage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raise_approximate_duration</span> <span class="o">=</span> <span class="n">raise_approximate_duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_well_formedness</span> <span class="o">=</span> <span class="n">check_well_formedness</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_stage_annotations</span> <span class="o">=</span> <span class="n">show_stage_annotations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segment_number</span> <span class="o">=</span> <span class="n">segment_number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempo_map</span> <span class="o">=</span> <span class="n">tempo_map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_signatures</span> <span class="o">=</span> <span class="n">time_signatures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_staff_size</span> <span class="o">=</span> <span class="n">staff_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_part</span> <span class="o">=</span> <span class="n">part</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ruler</span> <span class="o">=</span> <span class="n">ruler</span>

    <span class="c1"># SPECIAL METHODS</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Calls segment maker. Creates a blank score, interprets music handlers,</span>
<span class="sd">        and puts it into a lilypond file.</span>

<span class="sd">        Returns LilyPond file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># set up score structure and lilypond file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_score</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_lilypond_file</span><span class="p">()</span>

        <span class="c1"># set up time signatures and form labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_time_signature_contexts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_annotate_stages</span><span class="p">()</span>

        <span class="c1"># make music from handlers insert in score</span>
        <span class="k">with</span> <span class="n">abjad</span><span class="o">.</span><span class="n">systemtools</span><span class="o">.</span><span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Interpreting music handlers ... &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_interpret_music_handlers</span><span class="p">()</span>
            <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">timer</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">)</span>
            <span class="n">time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">seconds</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

        <span class="c1"># self._attach_rehearsal_mark()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_final_barline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_final_markup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_well_formedness</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_approximate_duration_in_seconds</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;...Done&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lilypond_file</span>

    <span class="c1"># PRIVATE METHODS</span>

    <span class="k">def</span> <span class="nf">_add_final_barline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Adds final barline to score.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">abbreviation</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_last_segment</span><span class="p">:</span>
            <span class="n">abbreviation</span> <span class="o">=</span> <span class="s1">&#39;|.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="o">.</span><span class="n">add_final_bar_line</span><span class="p">(</span>
            <span class="n">abbreviation</span><span class="o">=</span><span class="n">abbreviation</span><span class="p">,</span>
            <span class="n">to_each_voice</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_final_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Adds final markup at the end of the score.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_markup</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="o">.</span><span class="n">add_final_markup</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_markup</span><span class="p">,</span>
            <span class="n">extra_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">final_markup_extra_offset</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_annotate_stages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Adds stage number markup and barlines to score.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_stage_annotations</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Annotating stages...&#39;</span><span class="p">)</span>

        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">stage_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_stages</span><span class="p">):</span>
            <span class="n">start_measure_index</span><span class="p">,</span> <span class="n">stop_measure_index</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_stage_index_to_measure_indices</span><span class="p">(</span><span class="n">stage_index</span><span class="p">)</span>
            <span class="n">rehearsal_mark</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">indicatortools</span><span class="o">.</span><span class="n">RehearsalMark</span><span class="p">(</span>
                <span class="n">number</span><span class="o">=</span><span class="n">stage_index</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">start_measure</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">start_measure_index</span><span class="p">]</span>
            <span class="n">stop_measure</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">stop_measure_index</span><span class="p">]</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">rehearsal_mark</span><span class="p">,</span> <span class="n">start_measure</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">bar_line</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">BarLine</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">bar_line</span><span class="p">,</span> <span class="n">stop_measure</span><span class="p">)</span>


        <span class="n">scheme</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">schemetools</span><span class="o">.</span><span class="n">Scheme</span><span class="p">(</span><span class="s1">&#39;format-mark-box-alphabet&#39;</span><span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">setting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">)</span><span class="o">.</span><span class="n">markFormatter</span> <span class="o">=</span> <span class="n">scheme</span>

    <span class="k">def</span> <span class="nf">_attach_rehearsal_mark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Adds rehearsal mark (segment #) to score</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">segment_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segment_number</span>
        <span class="n">letter_number</span> <span class="o">=</span> <span class="n">segment_number</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">letter_number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">rehearsal_mark</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">indicatortools</span><span class="o">.</span><span class="n">RehearsalMark</span><span class="p">(</span>
            <span class="n">number</span><span class="o">=</span><span class="n">letter_number</span>
        <span class="p">)</span>
        <span class="n">voice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">[</span><span class="s1">&#39;Time Signatures and Tempi&#39;</span><span class="p">]</span>
        <span class="n">first_leaf</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span><span class="o">.</span><span class="n">get_leaf</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">rehearsal_mark</span><span class="p">,</span> <span class="n">first_leaf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_well_formedness</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Raises an exception if the score is not well-formed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_well_formedness</span><span class="p">:</span>
            <span class="n">score_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lilypond_file</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">score_block</span><span class="p">[</span><span class="s1">&#39;Score&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">abjad</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="o">.</span><span class="n">is_well_formed</span><span class="p">():</span>
                <span class="n">string</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span>
                    <span class="n">score</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tabulate_well_formedness_violations</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_interpret_music_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Fills the empty score with music based on each instrument&#39;s music</span>
<span class="sd">        handler and maker. Removes instrument indicators from staff contexts.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_stages</span><span class="p">):</span>
            <span class="n">stage_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Stage </span><span class="si">{}</span><span class="s1"> of </span><span class="si">{}</span><span class="s1">&#39;</span>
            <span class="n">stage_string</span> <span class="o">=</span> <span class="n">stage_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number_of_stages</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">stage_string</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">music_handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_music_handlers</span><span class="p">:</span>
                <span class="c1"># Format handler name</span>
                <span class="n">handler_instrument</span> <span class="o">=</span> <span class="n">music_handler</span><span class="o">.</span><span class="n">instrument</span><span class="o">.</span><span class="n">instrument_name</span>
                <span class="n">handler_instrument</span> <span class="o">=</span> <span class="n">handler_instrument</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">handler_instrument</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
                    <span class="n">handler_instrument</span> <span class="o">=</span> <span class="n">handler_instrument</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;I&#39;</span>
                <span class="n">handler_name</span> <span class="o">=</span> <span class="n">music_handler</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                <span class="n">handler_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">Music handler: </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span>
                <span class="n">handler_string</span> <span class="o">=</span> <span class="n">handler_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">handler_instrument</span><span class="p">,</span> <span class="n">handler_name</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">handler_string</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t\t</span><span class="s1">Making music...&#39;</span><span class="p">)</span>
                <span class="c1"># call the music handler</span>
                <span class="n">voices</span> <span class="o">=</span> <span class="n">music_handler</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t\t</span><span class="s1">Matching voices to staves...&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">voice</span> <span class="ow">in</span> <span class="n">voices</span><span class="p">:</span>
                    <span class="c1"># get the instrument attached to the voice</span>
                    <span class="n">voice_instrument</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span><span class="o">.</span><span class="n">get_indicator</span><span class="p">(</span>
                        <span class="n">abjad</span><span class="o">.</span><span class="n">Instrument</span>
                    <span class="p">)</span>
                    <span class="n">voice_instrument</span> <span class="o">=</span> <span class="n">voice_instrument</span><span class="o">.</span><span class="n">instrument_name</span>
                    <span class="n">voice_instrument</span> <span class="o">=</span> <span class="n">voice_instrument</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                    <span class="c1"># capitalize roman numeral</span>
                    <span class="k">if</span> <span class="n">voice_instrument</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
                        <span class="n">voice_instrument</span> <span class="o">=</span> <span class="n">voice_instrument</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;I&#39;</span>
                    <span class="c1"># loop through staves in score</span>
                    <span class="k">for</span> <span class="n">staff</span> <span class="ow">in</span> <span class="n">abjad</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">)</span><span class="o">.</span><span class="n">by_class</span><span class="p">(</span>
                            <span class="n">abjad</span><span class="o">.</span><span class="n">Staff</span><span class="p">):</span>
                        <span class="c1"># skip separator</span>
                        <span class="k">if</span> <span class="n">staff</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="s1">&#39;Separator&#39;</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="c1"># get staff instrument</span>
                        <span class="n">staff_instrument</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">staff</span><span class="p">)</span><span class="o">.</span><span class="n">get_annotation</span><span class="p">(</span>
                            <span class="s1">&#39;instrument&#39;</span>
                        <span class="p">)</span>
                        <span class="c1"># if instruments match</span>
                        <span class="k">if</span> <span class="n">voice</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">staff_map</span><span class="p">[</span><span class="n">staff</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="ow">and</span> \
                                <span class="n">voice_instrument</span> <span class="o">==</span> <span class="n">staff_instrument</span><span class="p">:</span>
                            <span class="c1"># remove the instrument indicator from voice</span>
                            <span class="n">abjad</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span>
                                <span class="n">abjad</span><span class="o">.</span><span class="n">instrumenttools</span><span class="o">.</span><span class="n">Instrument</span><span class="p">,</span>
                                <span class="n">voice</span>
                            <span class="p">)</span>
                            <span class="c1"># and either add voice to staff</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">staff</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">staff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span>
                            <span class="c1"># or extend existing voice</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">voice_in_staff</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="k">for</span> <span class="n">existing_voice</span> <span class="ow">in</span> <span class="n">staff</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">voice</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">existing_voice</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                                        <span class="n">existing_voice</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span>
                                        <span class="n">voice_in_staff</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">voice_in_staff</span><span class="p">:</span>
                                    <span class="n">staff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_label_instrument_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;TODO Adds instrument change markup to score.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        for each instrument staff group</span>
<span class="sd">            if instrument is different than previous segment</span>
<span class="sd">                attach markup</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_make_instrument_change_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument_name</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Creates instrument change markup as text with box.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instrument_name</span><span class="o">.</span><span class="n">instrument_name</span><span class="p">)</span>
        <span class="n">markup</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Markup</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">markup</span> <span class="o">=</span> <span class="n">markup</span><span class="o">.</span><span class="n">box</span><span class="p">()</span><span class="o">.</span><span class="n">override</span><span class="p">((</span><span class="s1">&#39;box-padding&#39;</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">markup</span>

    <span class="k">def</span> <span class="nf">_make_lilypond_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Makes a basic Lilypond file, removes the default blocks, and adds</span>
<span class="sd">        includes. Returns the Lilypond file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_part</span><span class="p">:</span>
            <span class="n">stylesheet</span> <span class="o">=</span> <span class="s1">&#39;stylesheet_part.ily&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stylesheet</span> <span class="o">=</span> <span class="s1">&#39;stylesheet_score.ily&#39;</span>
        <span class="n">stylesheet_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s1">&#39;..&#39;</span><span class="p">,</span>
            <span class="s1">&#39;..&#39;</span><span class="p">,</span>
            <span class="s1">&#39;includes&#39;</span><span class="p">,</span>
            <span class="n">stylesheet</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">includes</span> <span class="o">=</span> <span class="p">[</span><span class="n">stylesheet_path</span><span class="p">]</span>
        <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segment_number</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="s1">&#39;..&#39;</span><span class="p">,</span>
                <span class="s1">&#39;..&#39;</span><span class="p">,</span>
                <span class="s1">&#39;includes&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nonfirst-segment.ily&#39;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">lilypond_file</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">LilyPondFile</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">,</span>
            <span class="n">includes</span><span class="o">=</span><span class="n">includes</span><span class="p">,</span>
            <span class="n">use_relative_includes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">default_paper_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_page_size</span><span class="p">,</span>
            <span class="n">global_staff_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_staff_size</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lilypond_file</span><span class="o">.</span><span class="n">items</span><span class="p">[:]:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;layout&#39;</span><span class="p">,</span> <span class="s1">&#39;paper&#39;</span><span class="p">):</span>
                <span class="n">lilypond_file</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="n">composer</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Markup</span><span class="p">(</span><span class="s2">&quot;Joseph Davancens&quot;</span><span class="p">)</span>
        <span class="n">composer</span> <span class="o">=</span> <span class="n">composer</span><span class="o">.</span><span class="n">override</span><span class="p">((</span><span class="s2">&quot;font-name&quot;</span><span class="p">,</span> <span class="s2">&quot;Futura&quot;</span><span class="p">))</span>

        <span class="n">composer</span> <span class="o">=</span> <span class="n">composer</span><span class="o">.</span><span class="n">fontsize</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="c1"># composer = composer.hspace(20)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Markup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">override</span><span class="p">((</span><span class="s2">&quot;font-name&quot;</span><span class="p">,</span> <span class="s2">&quot;Futura&quot;</span><span class="p">))</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">fontsize</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">override</span><span class="p">((</span><span class="s2">&quot;font-series&quot;</span><span class="p">,</span> <span class="s2">&quot;Medium&quot;</span><span class="p">))</span>
        <span class="c1"># title = abjad.Markup.line([title]).center_align()</span>
        <span class="c1"># title = abjad.Markup.column([title])</span>

        <span class="n">subtitle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Markup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_name</span><span class="p">)</span>
        <span class="n">subtitle</span> <span class="o">=</span> <span class="n">subtitle</span><span class="o">.</span><span class="n">override</span><span class="p">((</span><span class="s2">&quot;font-name&quot;</span><span class="p">,</span> <span class="s2">&quot;Futura&quot;</span><span class="p">))</span>
        <span class="n">subtitle</span> <span class="o">=</span> <span class="n">subtitle</span><span class="o">.</span><span class="n">fontsize</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="c1"># subtitle = abjad.Markup.line([subtitle]).center_align()</span>
        <span class="c1"># subtitle = abjad.Markup.column([subtitle])</span>

        <span class="n">lilypond_file</span><span class="o">.</span><span class="n">header_block</span><span class="o">.</span><span class="n">composer</span> <span class="o">=</span> <span class="n">composer</span>
        <span class="n">lilypond_file</span><span class="o">.</span><span class="n">header_block</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="n">lilypond_file</span><span class="o">.</span><span class="n">header_block</span><span class="o">.</span><span class="n">subtitle</span> <span class="o">=</span> <span class="n">subtitle</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lilypond_file</span> <span class="o">=</span> <span class="n">lilypond_file</span>

    <span class="k">def</span> <span class="nf">_make_repeated_note_measures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Creates measures with repeated notes from time signatures for the</span>
<span class="sd">        time signature context.</span>
<span class="sd">        Returns list of measures.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">time_signatures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_signatures</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_stages</span><span class="p">]:</span>
            <span class="n">flattened_list</span> <span class="o">=</span> <span class="n">flatten_list</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>
            <span class="n">time_signatures</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">flattened_list</span><span class="p">)</span>
        <span class="n">measures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">time_signature</span> <span class="ow">in</span> <span class="n">time_signatures</span><span class="p">:</span>
            <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_signature</span><span class="o">.</span><span class="n">denominator</span><span class="p">)]</span> <span class="o">*</span> \
                <span class="n">time_signature</span><span class="o">.</span><span class="n">numerator</span>
            <span class="n">note_maker</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">NoteMaker</span><span class="p">()</span>
            <span class="n">notes</span> <span class="o">=</span> <span class="n">note_maker</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">durations</span><span class="p">)</span>
            <span class="n">measure</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">scoretools</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">time_signature</span><span class="p">,</span> <span class="n">notes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time_signature</span><span class="o">.</span><span class="n">denominator</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">beam</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">spannertools</span><span class="o">.</span><span class="n">Beam</span><span class="p">()</span>
                <span class="n">abjad</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">beam</span><span class="p">,</span> <span class="n">measure</span><span class="p">)</span>
            <span class="n">measures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">measures</span>

    <span class="k">def</span> <span class="nf">_make_score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Creates a blank score from a template object and configures bar</span>
<span class="sd">        numbers. Returns the blank score.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">score_template</span> <span class="o">=</span> <span class="n">ScoreTemplate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_list</span><span class="p">)</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">score_template</span><span class="p">()</span>
        <span class="n">first_bar_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_bar_number</span>
        <span class="k">if</span> <span class="n">first_bar_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">setting</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="o">.</span><span class="n">current_bar_number</span> <span class="o">=</span> <span class="n">first_bar_number</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="o">.</span><span class="n">bar_number</span><span class="o">.</span><span class="n">transparent</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_score</span> <span class="o">=</span> <span class="n">score</span>
        <span class="c1"># show score structure</span>
        <span class="c1"># for x in inspect(score).get_descendants():print(x)</span>

    <span class="k">def</span> <span class="nf">_make_skip_filled_measures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Creates measures with measure-length skips for time signature context.</span>
<span class="sd">        Returns list of measures.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">time_signatures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_signatures</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_stages</span><span class="p">]:</span>
            <span class="n">flattened_list</span> <span class="o">=</span> <span class="n">flatten_list</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>
            <span class="n">time_signatures</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">flattened_list</span><span class="p">)</span>
        <span class="n">measures</span> <span class="o">=</span> <span class="n">make_spacer_skip_measures</span><span class="p">(</span><span class="n">time_signatures</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">measures</span>

    <span class="k">def</span> <span class="nf">_populate_time_signature_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Makes and inserts blank measures for time signature context and</span>
<span class="sd">        attaches tempo indicators.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ruler</span><span class="p">:</span>
            <span class="n">measures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_repeated_note_measures</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">measures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_skip_filled_measures</span><span class="p">()</span>
        <span class="c1"># attach Tempi</span>
        <span class="k">for</span> <span class="n">tempo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempo_map</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tempo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">measures</span><span class="p">):</span>
                <span class="n">abjad</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">tempo</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">measures</span><span class="p">[</span><span class="n">tempo</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">leaves</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="n">measures</span><span class="p">)</span><span class="o">.</span><span class="n">by_class</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">)</span>
        <span class="n">leaves</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">leaves</span><span class="p">)</span>
        <span class="n">first_leaf</span> <span class="o">=</span> <span class="n">leaves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dummy_first_bar_command</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">indicatortools</span><span class="o">.</span><span class="n">LilyPondCommand</span><span class="p">(</span>
            <span class="s1">&#39;bar &quot;&quot;&#39;</span>
        <span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">dummy_first_bar_command</span><span class="p">,</span> <span class="n">first_leaf</span><span class="p">)</span>
        <span class="n">time_signature_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">voice</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Voice</span><span class="p">(</span><span class="n">measures</span><span class="p">)</span>
        <span class="n">time_signature_context</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">staff</span> <span class="ow">in</span> <span class="n">abjad</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">)</span><span class="o">.</span><span class="n">by_class</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Staff</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">staff</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="s1">&#39;Separator&#39;</span><span class="p">:</span>
                <span class="n">measures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_skip_filled_measures</span><span class="p">()</span>
                <span class="n">staff</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">measures</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_raise_approximate_duration_in_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Calculates the duration, in seconds, of the segment and raises an</span>
<span class="sd">        exception.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">raise_approximate_duration</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">[</span><span class="s1">&#39;Time Signature Context&#39;</span><span class="p">]</span>
        <span class="n">current_tempo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">leaves</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">by_class</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">)</span>
        <span class="n">measure_summaries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tempo_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">is_trending</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">leaves</span><span class="p">):</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">leaf</span><span class="p">)</span><span class="o">.</span><span class="n">get_duration</span><span class="p">()</span>
            <span class="n">tempi</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span>
                <span class="n">leaf</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_indicators</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">indicatortools</span><span class="o">.</span><span class="n">Tempo</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tempi</span><span class="p">:</span>
                <span class="n">current_tempo</span> <span class="o">=</span> <span class="n">tempi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">measure_summary</span> <span class="ow">in</span> <span class="n">measure_summaries</span><span class="p">[</span><span class="n">tempo_index</span><span class="p">:]:</span>
                    <span class="k">assert</span> <span class="n">measure_summary</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="n">measure_summary</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_tempo</span>
                <span class="n">tempo_index</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">is_trending</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">abjad</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span>
                <span class="n">leaf</span>
            <span class="p">)</span><span class="o">.</span><span class="n">has_indicator</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">indicatortools</span><span class="o">.</span><span class="n">Accelerando</span><span class="p">):</span>
                <span class="n">is_trending</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">abjad</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span>
                <span class="n">leaf</span>
            <span class="p">)</span><span class="o">.</span><span class="n">has_indicator</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">indicatortools</span><span class="o">.</span><span class="n">Ritardando</span><span class="p">):</span>
                <span class="n">is_trending</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">next_tempo</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">measure_summary</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">duration</span><span class="p">,</span>
                <span class="n">current_tempo</span><span class="p">,</span>
                <span class="n">is_trending</span><span class="p">,</span>
                <span class="n">next_tempo</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">measure_summaries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure_summary</span><span class="p">)</span>
        <span class="n">total_duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">durationtools</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">measure_summary</span> <span class="ow">in</span> <span class="n">measure_summaries</span><span class="p">:</span>
            <span class="n">duration</span><span class="p">,</span> <span class="n">current_tempo</span><span class="p">,</span> <span class="n">is_trending</span><span class="p">,</span> <span class="n">next_tempo</span> <span class="o">=</span> <span class="n">measure_summary</span>
            <span class="k">if</span> <span class="n">is_trending</span><span class="p">:</span>
                <span class="n">effective_tempo</span> <span class="o">=</span> <span class="n">current_tempo</span> <span class="o">+</span> <span class="n">next_tempo</span>
                <span class="n">effective_tempo</span> <span class="o">/=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">effective_tempo</span> <span class="o">=</span> <span class="n">current_tempo</span>
            <span class="n">duration_</span> <span class="o">=</span> <span class="n">effective_tempo</span><span class="o">.</span><span class="n">duration_to_milliseconds</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
            <span class="n">duration_</span> <span class="o">/=</span> <span class="mi">1000</span>
            <span class="n">total_duration</span> <span class="o">+=</span> <span class="n">duration_</span>
        <span class="n">total_duration</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">total_duration</span><span class="p">))</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> seconds&#39;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_duration</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stage_index_to_measure_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage_index</span><span class="p">):</span>
        <span class="n">stage_number</span> <span class="o">=</span> <span class="n">stage_index</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">stage_number</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_count</span>
        <span class="n">measure_indices</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">mathtools</span><span class="o">.</span><span class="n">cumulative_sums</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measures_per_stage</span>
        <span class="p">)</span>
        <span class="n">start_measure_index</span> <span class="o">=</span> <span class="n">measure_indices</span><span class="p">[</span><span class="n">stage_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">stop_measure_index</span> <span class="o">=</span> <span class="n">measure_indices</span><span class="p">[</span><span class="n">stage_number</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">start_measure_index</span><span class="p">,</span> <span class="n">stop_measure_index</span>
    <span class="c1"># PUBLIC PROPERTIES</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">final_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Gets final markup.</span>

<span class="sd">        Set to markup or none.</span>

<span class="sd">        Returns markup or none.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_final_markup</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">final_markup_extra_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Gets final markup extra offset.</span>

<span class="sd">        Set to pair or none.</span>

<span class="sd">        Returns pair or none.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_final_markup_extra_offset</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">measure_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Gets measure count.</span>

<span class="sd">        Returns nonnegative integer.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">time_signatures</span> <span class="o">=</span> <span class="n">flatten_list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_signatures</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">number_of_stages</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">time_signatures</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">music_makers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Gets music-makers.</span>

<span class="sd">        Returns tuple of music-makers.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_music_makers</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_music_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Gets music-handlers.</span>

<span class="sd">        Returns tuples of music-handlers.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_music_handlers</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">show_stage_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Is true when segment should annotate stages.</span>

<span class="sd">        Set to true or false.</span>

<span class="sd">        Returns true or false.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_stage_annotations</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stage_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Gets stage count.</span>

<span class="sd">        Returns nonnegative integer.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measures_per_stage</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transpose_score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Is true when segment should notate transposing instruments</span>
<span class="sd">        as written (rather than as sounding).</span>

<span class="sd">        Set to true or false.</span>

<span class="sd">        Returns true or false.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose_score</span>

    <span class="c1"># PUBLIC METHODS</span>

<div class="viewcode-block" id="SegmentMaker.add_music_handlers"><a class="viewcode-back" href="../../../../surge.tools.makers.html#surge.tools.makers.SegmentMaker.SegmentMaker.add_music_handlers">[docs]</a>    <span class="k">def</span> <span class="nf">add_music_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">music_handlers</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Adds music handlers.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_music_handlers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">music_handlers</span><span class="p">)</span></div>

<div class="viewcode-block" id="SegmentMaker.get_music_maker"><a class="viewcode-back" href="../../../../surge.tools.makers.html#surge.tools.makers.SegmentMaker.SegmentMaker.get_music_maker">[docs]</a>    <span class="k">def</span> <span class="nf">get_music_maker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context_name</span><span class="p">,</span> <span class="n">stage</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns music maker</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">music_makers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fingering_music_maker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">music_makers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fingering_music_maker</span><span class="o">.</span><span class="n">context_name</span> <span class="o">==</span> <span class="n">context_name</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">fingering_music_maker</span><span class="o">.</span><span class="n">start_stage</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">fingering_music_maker</span><span class="o">.</span><span class="n">stop_stage</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">fingering_music_maker</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;no music-maker for </span><span class="si">{!r}</span><span class="s1"> found for stage </span><span class="si">{}</span><span class="s1">.&#39;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">context_name</span><span class="p">,</span> <span class="n">stage</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Joseph Davancens.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>